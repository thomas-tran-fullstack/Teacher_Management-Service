<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <title>Products - StarShoe Admin</title>
        <h:outputStylesheet library="css" name="admin.css"/>
    </h:head>
    <h:body>
        <ui:include src="/template/admin-header.xhtml"/>
        <ui:include src="/template/admin-sidebar.xhtml"/>

        <div class="main-content">
            <div class="form-container">
                <!-- Replace inline add/edit form with a simple button link -->
                <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:20px;">
                    <h3 style="margin:0;">Products</h3>
                    <a href="#{request.contextPath}/admin/product-add-edit.xhtml" style="display:inline-block;padding:10px 16px;background:linear-gradient(90deg,#ff6b00,#ff8c42);color:#fff;border-radius:8px;text-decoration:none;font-weight:700;">Add New Product</a>
                </div>

                <!-- SEARCH -->
                <h:form styleClass="search-bar">
                    <h3 style="margin-top:0;">Search Product</h3>
                    <h:inputText styleClass="search" value="#{productMB.searchKeyword}">
                        <f:passThroughAttribute name="placeholder" value="Enter product name..." />
                    </h:inputText>
                    <h:commandButton value="Search" action="#{productMB.search}" styleClass="btn-search" />
                </h:form>
            </div>

            <!-- PRODUCT TABLE -->
            <h:form>
                <h:dataTable value="#{productMB.productList}" var="p" border="1" styleClass="product-table">
                    <h:column>
                        <f:facet name="header">ID</f:facet>
                            #{p.productID}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Image</f:facet>
                        <h:graphicImage library="images" name="products/#{p.image}" width="60" height="60" />
                    </h:column>

                    <h:column>
                        <f:facet name="header">Name</f:facet>
                            #{p.productName}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Brand</f:facet>
                            #{p.brandID.brandName}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Category</f:facet>
                            #{p.categoryID.categoryName}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Price</f:facet>
                        <div style="font-weight: 700;">
                            <h:panelGroup rendered="#{p.isSale and p.salePercentage > 0}">
                                <span style="color: #999; text-decoration: line-through;">
                                    <h:outputText value="#{p.price}">
                                        <f:convertNumber type="currency" currencySymbol="$"/>
                                    </h:outputText>
                                </span><br/>
                                <span style="color: #d32f2f; font-size: 14px;">
                                    <h:outputText value="#{p.salePrice}">
                                        <f:convertNumber type="currency" currencySymbol="$"/>
                                    </h:outputText>
                                    <span style="color: #d32f2f; font-size: 11px;">-#{p.salePercentage}%</span>
                                </span>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{not (p.isSale and p.salePercentage > 0)}">
                                <h:outputText value="#{p.price}">
                                    <f:convertNumber type="currency" currencySymbol="$"/>
                                </h:outputText>
                            </h:panelGroup>
                        </div>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Quantity</f:facet>
                            #{p.quantity}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Action</f:facet>
                        <h:link outcome="/admin/product-add-edit.xhtml" styleClass="action-icon" title="Edit">
                            <f:param name="productId" value="#{p.productID}" />
                            <h:graphicImage library="images" name="edit.png" alt="Edit" />
                        </h:link>
                        <h:commandLink action="#{productMB.delete(p)}" styleClass="action-icon"
                                       title="Delete" onclick="return confirm('Are you sure?');">
                            <h:graphicImage library="images" name="delete.png" alt="Delete" />
                        </h:commandLink>
                    </h:column>
                </h:dataTable>
            </h:form>
        </div>
    </h:body>
</html>