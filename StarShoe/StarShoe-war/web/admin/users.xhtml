<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <title>User Management - StarShoe</title>
        <h:outputStylesheet library="css" name="admin.css" />
    </h:head>

    <h:body>
        <ui:include src="/template/admin-header.xhtml" />
        <ui:include src="/template/admin-sidebar.xhtml" />

        <div class="main-content">
            <h:messages id="growl" globalOnly="true" style="color:green;font-weight:bold;margin-bottom:10px"/>

            <div class="form-container">
                <h:form id="userForm" styleClass="add-form">
                    <h3>Add User</h3>

                    <table class="form-table">

                        <tr>
                            <td>Full Name:</td>
                            <td>
                                <h:inputText id="fullName" value="#{userMB.fullName}" required="true"
                                             requiredMessage="Full name is required"/>
                            </td>
                            <td><h:message for="fullName" style="color:red;font-size:12px"/></td>
                        </tr>

                        <tr>
                            <td>Username:</td>
                            <td>
                                <h:inputText id="username" value="#{userMB.selectedUser.username}" required="true"
                                             requiredMessage="Username is required"/>
                            </td>
                            <td><h:message for="username" style="color:red;font-size:12px"/></td>
                        </tr>

                        <tr>
                            <td>Password:</td>
                            <td>
                                <h:inputSecret id="password" value="#{userMB.selectedUser.passwordHash}"
                                               redisplay="true" required="true"
                                               requiredMessage="Password is required"/>
                            </td>
                            <td><h:message for="password" style="color:red;font-size:12px"/></td>
                        </tr>

                        <tr>
                            <td>Email:</td>
                            <td>
                                <h:inputText id="email" value="#{userMB.selectedUser.email}" required="true"
                                             requiredMessage="Email is required"/>
                            </td>
                            <td><h:message for="email" style="color:red;font-size:12px"/></td>
                        </tr>

                        <tr>
                            <td>Phone:</td>
                            <td>
                                <h:inputText id="phone" value="#{userMB.phone}" required="true"
                                             requiredMessage="Phone is required"/>
                            </td>
                            <td><h:message for="phone" style="color:red;font-size:12px"/></td>
                        </tr>

                        <tr>
                            <td>Address (Customer):</td>
                            <td><h:inputText id="address" value="#{userMB.address}"/></td>
                            <td><h:message for="address" style="color:red;font-size:12px"/></td>
                        </tr>

                        <tr>
                            <td>Position (Employee):</td>
                            <td><h:inputText id="position" value="#{userMB.position}"/></td>
                            <td><h:message for="position" style="color:red;font-size:12px"/></td>
                        </tr>

                        <tr>
                            <td>Role:</td>
                            <td>
                                <h:selectOneMenu id="role" value="#{userMB.selectedRoleId}" required="true"
                                                 requiredMessage="Role is required">
                                    <f:selectItem itemLabel="--Select--" itemValue="#{null}"/>
                                    <f:selectItems value="#{userMB.roleList}" var="r"
                                                   itemValue="#{r.roleID}" itemLabel="#{r.roleName}"/>
                                </h:selectOneMenu>
                            </td>
                            <td><h:message for="role" style="color:red;font-size:12px"/></td>
                        </tr>

                    </table>
                    <h:commandButton value="Confirm" action="#{userMB.confirm}" styleClass="btn-confirm"/>
                    <h:commandButton value="Reset" action="#{userMB.resetForm}" immediate="true" styleClass="btn-reset"/>

                </h:form>

                <h:form id="searchForm" styleClass="search-bar">
                    <h3>Search User</h3>
                    <h:inputText value="#{userMB.searchKeyword}" styleClass="search">
                        <f:passThroughAttribute name="placeholder" value="Enter username..." />
                    </h:inputText>
                    <h:commandButton value="Search" action="#{userMB.search}" styleClass="btn-search">
                        <f:ajax execute="@form" render="userTable growl"/>
                    </h:commandButton>
                </h:form>

            </div>

            <!-- âœ… USER TABLE -->
            <h:form id="userTable">
                <h:dataTable value="#{userMB.userList}" var="u" border="1" styleClass="product-table">

                    <h:column><f:facet name="header">ID</f:facet>#{u.userID}</h:column>
                    <h:column><f:facet name="header">Username</f:facet>#{u.username}</h:column>
                    <h:column><f:facet name="header">Email</f:facet>#{u.email}</h:column>
                    <h:column><f:facet name="header">Role</f:facet>#{u.roleID.roleName}</h:column>

                    <h:column>
                        <f:facet name="header">Action</f:facet>
                        <h:commandLink action="#{userMB.delete(u)}" styleClass="action-icon"
                                       title="Delete" onclick="return confirm('Are you sure?');">
                            <h:graphicImage library="images" name="delete.png" alt="Delete"/>
                            <f:ajax execute="@this" render="@form userForm growl"/>
                        </h:commandLink>
                    </h:column>

                </h:dataTable>
            </h:form>

        </div>
    </h:body>
</html>
