<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <title>Order Management - StarShoe</title>
        <h:outputStylesheet library="css" name="admin.css"/>
        <style>
            .orders-page {
                max-width: 1200px;
                margin: 0 auto;
            }
            .page-header {
                margin-bottom: 30px;
            }
            .page-header h2 {
                font-size: 24px;
                font-weight: 700;
                color: var(--primary-color);
                margin: 0;
            }
            .btn-approve, .btn-reject {
                padding: 6px 12px;
                border: none;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 700;
                cursor: pointer;
                transition: 0.15s;
                margin: 0 4px;
            }
            .btn-approve {
                background-color: #28a745;
                color: white;
            }
            .btn-approve:hover {
                background-color: #218838;
            }
            .btn-reject {
                background-color: #dc3545;
                color: white;
            }
            .btn-reject:hover {
                background-color: #c82333;
            }
            .status-badge {
                padding: 6px 10px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 700;
            }
            .status-pending {
                background-color: #fff3cd;
                color: #856404;
            }
            .status-approved {
                background-color: #d4edda;
                color: #155724;
            }
            .status-rejected {
                background-color: #f8d7da;
                color: #721c24;
            }
        </style>
    </h:head>
    <h:body>
        <ui:include src="/template/admin-header.xhtml"/>
        <ui:include src="/template/admin-sidebar.xhtml"/>

        <div class="main-content">
            <div class="orders-page">
                <div class="page-header">
                    <h2>Order Management</h2>
                </div>

                <h:messages globalOnly="true" style="color: green; margin: 12px 0; font-weight: 700; padding: 12px; background: #d4edda; border-radius: 6px;"/>

                <h:form>
                    <h:dataTable value="#{orderMB.orderList}" var="o" styleClass="product-table">
                        <h:column>
                            <f:facet name="header">Order ID</f:facet>
                            ##{o.orderID}
                        </h:column>

                        <h:column>
                            <f:facet name="header">Customer</f:facet>
                            #{o.customerID != null ? o.customerID.fullName : 'Unknown'}
                        </h:column>

                        <h:column>
                            <f:facet name="header">Date</f:facet>
                            <h:outputText value="#{o.orderDate}">
                                <f:convertDateTime pattern="MM/dd/yyyy HH:mm"/>
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Amount</f:facet>
                            <h:outputText value="#{o.totalAmount}">
                                <f:convertNumber type="currency" currencySymbol="$"/>
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Status</f:facet>
                            <span class="status-badge" 
                                  styleClass="#{o.status eq 'Pending' ? 'status-pending' : o.status eq 'Approved' ? 'status-approved' : 'status-rejected'}">
                                #{o.status}
                            </span>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Action</f:facet>
                            <div style="white-space: nowrap;">
                                <h:link outcome="/admin/orderdetails.xhtml" value="Details" style="color: var(--accent-color); text-decoration: none; font-weight: 700; margin-right: 8px;">
                                    <f:param name="orderId" value="#{o.orderID}"/>
                                </h:link>

                                <h:commandButton value="Approve" action="#{orderMB.approveOrder(o)}" 
                                                styleClass="btn-approve" rendered="#{o.status eq 'Pending'}">
                                    <f:ajax execute="@this" render="@form"/>
                                </h:commandButton>

                                <h:commandButton value="Reject" action="#{orderMB.rejectOrder(o)}" 
                                                styleClass="btn-reject" rendered="#{o.status eq 'Pending'}"
                                                onclick="return confirm('Are you sure you want to reject this order?');"/>
                            </div>
                        </h:column>
                    </h:dataTable>
                </h:form>
            </div>
        </div>
    </h:body>
</html>
